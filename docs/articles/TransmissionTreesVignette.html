<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>treespace worked example: Transmission trees • treespace</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="treespace worked example: Transmission trees">
<meta property="og:description" content="treespace">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">treespace</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DengueVignette.html">treespace worked example: Dengue trees</a>
    </li>
    <li>
      <a href="../articles/TransmissionTreesVignette.html">treespace worked example: Transmission trees</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Exploration of landscapes of phylogenetic trees</a>
    </li>
    <li>
      <a href="../articles/tipCategories.html">Comparing trees by tip label categories</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/thibautjombart/treespace/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>treespace worked example: Transmission
trees</h1>
                        <h4 data-toc-skip class="author">Michelle
Kendall</h4>
            
            <h4 data-toc-skip class="date">2023-09-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/thibautjombart/treespace/blob/HEAD/vignettes/TransmissionTreesVignette.Rmd" class="external-link"><code>vignettes/TransmissionTreesVignette.Rmd</code></a></small>
      <div class="hidden name"><code>TransmissionTreesVignette.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates the use of <em>treespace</em> to compare a
collection of transmission trees as proposed in <a href="https://projecteuclid.org/journals/statistical-science/volume-33/issue-1/Estimating-Transmission-from-Genetic-and-Epidemiological-Data--A-Metric/10.1214/17-STS637.full" class="external-link">Kendall
et al. 2018</a>.</p>
<p>First we load the package <em>treespace</em>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=treespace" class="external-link">treespace</a></span><span class="op">)</span></span></code></pre></div>
<p><em>treespace</em> contains three functions for handling and
comparing transmission trees:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/findMRCIs.html">findMRCIs()</a></code> which takes a “who infected whom matrix”
(the information about infectors and infectees; more on this below) and
outputs:</li>
</ol>
<ul>
<li><p><code>sourceCase</code>: the number of the node which is the
source case, i.e. the common infector of all cases (outputs a warning if
there is more than one source case).</p></li>
<li><p><code>mrcis</code>: a matrix where, for each pair of individuals
i and j, the entry (i,j) is the node number of their MRCI. Note that if
i infected j then this entry is i itself.</p></li>
<li><p><code>mrciDepths</code>: a matrix where, for each pair of
individuals i and j, the entry (i,j) is the <em>depth</em> of their
MRCI, defined as the number of edges from the source case. The source
case has depth zero, its direct infectees have depth 1, and so
on.</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p><code><a href="../reference/wiwTreeDist.html">wiwTreeDist()</a></code> which takes a list of
<code>mrciDepths</code> matrices and computes the distances between
them. You have to supply the list of sampled cases in which you are
interested, and then it takes the Euclidean distance between each pair
of matrices restricted to the sampled cases (and written long-hand, as a
vector)</p></li>
<li><p><code><a href="../reference/wiwMedTree.html">wiwMedTree()</a></code> which takes a list of
<code>mrciDepths</code> matrices, the list of sampled cases, an optional
list of weights, and outputs the median transmission tree</p></li>
</ol>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>We define a “who infected whom matrix” as a matrix of two columns,
where the first represents the infectors and the second represents their
infectees. For example, a simple transmission chain could be represented
like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Infector<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,Infectee<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> </span>
<span><span class="va">tree1</span></span></code></pre></div>
<pre><code><span><span class="co">##      Infector Infectee</span></span>
<span><span class="co">## [1,]        1        2</span></span>
<span><span class="co">## [2,]        2        3</span></span>
<span><span class="co">## [3,]        3        4</span></span>
<span><span class="co">## [4,]        4        5</span></span>
<span><span class="co">## [5,]        5        6</span></span></code></pre>
<p>This can be easily visualised as a transmission chain using graph
plotting packages such as <em>igraph</em> or <em>visNetwork</em>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="co"># set plotting options:</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/igraph_options.html" class="external-link">igraph_options</a></span><span class="op">(</span>vertex.size<span class="op">=</span><span class="fl">15</span>,</span>
<span>               vertex.color<span class="op">=</span><span class="st">"cyan"</span>,</span>
<span>               vertex.label.cex<span class="op">=</span><span class="fl">2</span>,</span>
<span>               edge.color<span class="op">=</span><span class="st">"lightgrey"</span>,</span>
<span>               edge.arrow.size<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree1graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_edgelist.html" class="external-link">graph_from_edgelist</a></span><span class="op">(</span><span class="va">tree1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree1graph</span><span class="op">)</span></span></code></pre></div>
<p><img src="TransmissionTreesVignette_files/figure-html/igraph_tree1-1.png" width="672"></p>
<p>Applying the function <code>findMRCIs</code> gives the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/findMRCIs.html">findMRCIs</a></span><span class="op">(</span><span class="va">tree1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $sourceCase</span></span>
<span><span class="co">## [1] 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mrcis</span></span>
<span><span class="co">##   1 2 3 4 5 6</span></span>
<span><span class="co">## 1 1 1 1 1 1 1</span></span>
<span><span class="co">## 2 1 2 2 2 2 2</span></span>
<span><span class="co">## 3 1 2 3 3 3 3</span></span>
<span><span class="co">## 4 1 2 3 4 4 4</span></span>
<span><span class="co">## 5 1 2 3 4 5 5</span></span>
<span><span class="co">## 6 1 2 3 4 5 6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mrciDepths</span></span>
<span><span class="co">##   1 2 3 4 5 6</span></span>
<span><span class="co">## 1 0 0 0 0 0 0</span></span>
<span><span class="co">## 2 0 1 1 1 1 1</span></span>
<span><span class="co">## 3 0 1 2 2 2 2</span></span>
<span><span class="co">## 4 0 1 2 3 3 3</span></span>
<span><span class="co">## 5 0 1 2 3 4 4</span></span>
<span><span class="co">## 6 0 1 2 3 4 5</span></span></code></pre>
<div class="section level3">
<h3 id="comparing-three-simple-trees">Comparing three simple trees<a class="anchor" aria-label="anchor" href="#comparing-three-simple-trees"></a>
</h3>
<p>Suppose we had other hypotheses for the transmission tree which
describes who infected whom amongst these six cases:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a second scenario:</span></span>
<span><span class="va">tree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Infector<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,Infectee<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">tree2</span></span></code></pre></div>
<pre><code><span><span class="co">##      Infector Infectee</span></span>
<span><span class="co">## [1,]        1        2</span></span>
<span><span class="co">## [2,]        5        3</span></span>
<span><span class="co">## [3,]        2        4</span></span>
<span><span class="co">## [4,]        2        5</span></span>
<span><span class="co">## [5,]        3        6</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree2graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_edgelist.html" class="external-link">graph_from_edgelist</a></span><span class="op">(</span><span class="va">tree2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree2graph</span><span class="op">)</span></span></code></pre></div>
<p><img src="TransmissionTreesVignette_files/figure-html/trees2_and_3-1.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># and a third scenario:</span></span>
<span><span class="va">tree3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Infector<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span>,Infectee<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">tree3</span></span></code></pre></div>
<pre><code><span><span class="co">##      Infector Infectee</span></span>
<span><span class="co">## [1,]        2        1</span></span>
<span><span class="co">## [2,]        2        3</span></span>
<span><span class="co">## [3,]        2        4</span></span>
<span><span class="co">## [4,]        2        6</span></span>
<span><span class="co">## [5,]        6        5</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree3graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_edgelist.html" class="external-link">graph_from_edgelist</a></span><span class="op">(</span><span class="va">tree3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree3graph</span><span class="op">)</span></span></code></pre></div>
<p><img src="TransmissionTreesVignette_files/figure-html/trees2_and_3-2.png" width="672"></p>
<p>Then we can use <em>treespace</em> functions to make the following
comparisons:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findMRCIs.html">findMRCIs</a></span><span class="op">(</span><span class="va">tree1</span><span class="op">)</span> <span class="co"># find the source case, MRCIs and MRCI depths for tree 1</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findMRCIs.html">findMRCIs</a></span><span class="op">(</span><span class="va">tree2</span><span class="op">)</span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findMRCIs.html">findMRCIs</a></span><span class="op">(</span><span class="va">tree3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m1</span><span class="op">$</span><span class="va">mrciDepths</span>,<span class="va">m2</span><span class="op">$</span><span class="va">mrciDepths</span>,<span class="va">m3</span><span class="op">$</span><span class="va">mrciDepths</span><span class="op">)</span> <span class="co"># create a list of the mrciDepths matrices</span></span>
<span><span class="va">matList</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##   1 2 3 4 5 6</span></span>
<span><span class="co">## 1 0 0 0 0 0 0</span></span>
<span><span class="co">## 2 0 1 1 1 1 1</span></span>
<span><span class="co">## 3 0 1 2 2 2 2</span></span>
<span><span class="co">## 4 0 1 2 3 3 3</span></span>
<span><span class="co">## 5 0 1 2 3 4 4</span></span>
<span><span class="co">## 6 0 1 2 3 4 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##   1 2 3 4 5 6</span></span>
<span><span class="co">## 1 0 0 0 0 0 0</span></span>
<span><span class="co">## 2 0 1 1 1 1 1</span></span>
<span><span class="co">## 3 0 1 3 1 2 3</span></span>
<span><span class="co">## 4 0 1 1 2 1 1</span></span>
<span><span class="co">## 5 0 1 2 1 2 2</span></span>
<span><span class="co">## 6 0 1 3 1 2 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##   1 2 3 4 5 6</span></span>
<span><span class="co">## 1 1 0 0 0 0 0</span></span>
<span><span class="co">## 2 0 0 0 0 0 0</span></span>
<span><span class="co">## 3 0 0 1 0 0 0</span></span>
<span><span class="co">## 4 0 0 0 1 0 0</span></span>
<span><span class="co">## 5 0 0 0 0 2 1</span></span>
<span><span class="co">## 6 0 0 0 0 1 1</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wiwTreeDist.html">wiwTreeDist</a></span><span class="op">(</span><span class="va">matList</span>, sampled<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="co"># find the Euclidean distances between these matrices, where all six cases are sampled</span></span></code></pre></div>
<pre><code><span><span class="co">##        1      2</span></span>
<span><span class="co">## 2  5.916       </span></span>
<span><span class="co">## 3 10.630  7.616</span></span></code></pre>
<p>If we had only sampled cases 4, 5 and 6, so that “1”, “2” and “3”
could be regarded as arbitrary names of inferred, unsampled cases, we
would compute:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wiwTreeDist.html">wiwTreeDist</a></span><span class="op">(</span><span class="va">matList</span>, sampled<span class="op">=</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       1     2</span></span>
<span><span class="co">## 2 5.477      </span></span>
<span><span class="co">## 3 8.832 4.000</span></span></code></pre>
<p>which substantially changes the measures of similarities and
differences between the trees.</p>
</div>
<div class="section level3">
<h3 id="comparing-many-trees-using-an-mds-plot">Comparing many trees using an MDS plot<a class="anchor" aria-label="anchor" href="#comparing-many-trees-using-an-mds-plot"></a>
</h3>
<p>Finally, we demonstrate comparing a larger set of transmission trees
and finding the median:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">RNGversion</a></span><span class="op">(</span><span class="st">"3.5.0"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="co"># create a list of 500 random transmission trees with 11 cases, where the source case is fixed as case 1:</span></span>
<span><span class="va">treelistSC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html" class="external-link">rtree</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">$</span><span class="va">edge</span> <span class="co"># effectively creating a random transmission scenario</span></span>
<span>  <span class="va">relabel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span> <span class="co"># create a relabelling so that infections don't all happen in numerical order, but we force the source case to be 1:</span></span>
<span>  <span class="va">relabel</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">relabel</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">relabel</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">relabel</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">relabelledEdges1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">edges</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">relabel</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">relabelledEdges2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">edges</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">relabel</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">relabelledEdges1</span>,<span class="va">relabelledEdges2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create 500 more random transmission trees, but where the source case is fixed as case 2:</span></span>
<span><span class="va">treelistSC2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html" class="external-link">rtree</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">$</span><span class="va">edge</span> </span>
<span>  <span class="va">relabel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span> </span>
<span>  <span class="va">relabel</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">relabel</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">relabel</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">relabel</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  <span class="va">relabelledEdges1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">edges</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">relabel</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">relabelledEdges2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">edges</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">relabel</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">relabelledEdges1</span>,<span class="va">relabelledEdges2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine:</span></span>
<span><span class="va">combinedLists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treelistSC1</span>,<span class="va">treelistSC2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get mrciDepths matrices:</span></span>
<span><span class="va">matList1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">combinedLists</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/findMRCIs.html">findMRCIs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">mrciDepths</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find pairwise tree distances, treating all cases as sampled:</span></span>
<span><span class="va">WiwDists1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wiwTreeDist.html">wiwTreeDist</a></span><span class="op">(</span><span class="va">matList1000</span>, sampled<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have a pairwise distance matrix we can use
multidimensional scaling (MDS) to view the relative distances between
the trees in a 2D projection. We will colour the points in the
projection by the “depth” of the corresponding tree, and use symbols to
indicate the source case. For “depth” here we simply use the mean of
each “mrciDepths” matrix.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wiwMDS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ade4/man/dudi.pco.html" class="external-link">dudi.pco</a></span><span class="op">(</span><span class="va">WiwDists1000</span>, scannf<span class="op">=</span><span class="cn">FALSE</span>, nf<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wiwPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">wiwMDS</span><span class="op">$</span><span class="va">li</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">wiwMDS</span><span class="op">$</span><span class="va">li</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,y<span class="op">=</span><span class="va">wiwMDS</span><span class="op">$</span><span class="va">li</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare aesthetics</span></span>
<span><span class="va">depths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">matList1000</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sourcecase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="va">num</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"2"</span>,<span class="va">num</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare colours:</span></span>
<span><span class="va">colfunc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">10</span>,<span class="st">"Spectral"</span><span class="op">)</span>, space<span class="op">=</span><span class="st">"Lab"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wiwPlot</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span>, colour<span class="op">=</span><span class="st">"gray60"</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>shape<span class="op">=</span><span class="va">sourcecase</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">depths</span>, shape<span class="op">=</span><span class="va">sourcecase</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradientn</a></span><span class="op">(</span><span class="st">"Mean of v\n"</span>, </span>
<span>                         colours<span class="op">=</span><span class="fu">colfunc</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>                         guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colourbar</a></span><span class="op">(</span>barheight<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_shape.html" class="external-link">scale_shape_discrete</a></span><span class="op">(</span><span class="st">"Source case\n"</span>, solid<span class="op">=</span><span class="cn">T</span>, guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>keyheight <span class="op">=</span> <span class="fl">3</span>, keywidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span>, base_family <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span>, base_family <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span>, axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="TransmissionTreesVignette_files/figure-html/wiw_MDS1000-1.png" width="672"></p>
<p>The symmetry in the plot corresponds to the different source cases,
and the trees are also clearly separated by depth.</p>
</div>
<div class="section level3">
<h3 id="median-trees">Median trees<a class="anchor" aria-label="anchor" href="#median-trees"></a>
</h3>
<p>If our transmission trees corresponded to real data it could be
meaningful to find a single representative tree. To find the geometric
median tree(s) from a collection, we use the function
<code>wiwMedTree</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">med</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wiwMedTree.html">wiwMedTree</a></span><span class="op">(</span><span class="va">matList1000</span><span class="op">)</span></span></code></pre></div>
<p>This returns a list with components:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">med</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "centre"    "distances" "mindist"   "median"</span></span></code></pre>
<ul>
<li><p><code>centre</code> is the mean vector (which may not necessarily
correspond to a valid transmission tree with a single source
case)</p></li>
<li><p><code>distances</code> gives the distance of each tree from the
centre, as a vector</p></li>
<li><p><code>mindist</code> gives the minimum of these
distances</p></li>
<li><p><code>median</code> gives the number(s) of the median
tree(s)</p></li>
</ul>
<p>Here the median trees are:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">med</span><span class="op">$</span><span class="va">median</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 817</span></span></code></pre>
<p>The first one looks like this:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medgraph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_edgelist.html" class="external-link">graph_from_edgelist</a></span><span class="op">(</span><span class="va">combinedLists</span><span class="op">[[</span><span class="va">med</span><span class="op">$</span><span class="va">median</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">medgraph</span><span class="op">)</span></span></code></pre></div>
<p><img src="TransmissionTreesVignette_files/figure-html/wiwMedTreePlot-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thibaut Jombart, Michelle Kendall, Jacob Almagro-Garcia, Caroline Colijn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
