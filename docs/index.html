<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistical Exploration of Landscapes of Phylogenetic Trees • treespace</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">treespace</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">

<div id="treespace-exploration-of-landscapes-of-phylogenetic-trees" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#treespace-exploration-of-landscapes-of-phylogenetic-trees" class="anchor"> </a><em>treespace</em>: exploration of landscapes of phylogenetic trees</h1></div>
<p><em>treespace</em> implements new methods for the exploration and analysis of distributions of phylogenetic trees for a given set of taxa.</p>
<div id="installing-treespace" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-treespace" class="anchor"> </a>Installing <em>treespace</em>
</h2>
<p>To install the development version from github:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">"thibautjombart/treespace"</span>)</code></pre></div>
<p>The stable version can be installed from CRAN using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"treespace"</span>)</code></pre></div>
<p>Then, to load the package, use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"treespace"</span>)</code></pre></div>
</div>
<div id="content-overview" class="section level2">
<h2 class="hasAnchor">
<a href="#content-overview" class="anchor"> </a>Content overview</h2>
<p>The main functions implemented in <em>treespace</em> are: * <strong><code>treespace</code></strong>: explore landscapes of phylogenetic trees * <strong><code>treespaceServer</code></strong>: open up an application in a web browser for an interactive exploration of the diversity in a set of trees * <strong><code>findGroves</code></strong>: identify clusters of similar trees * <strong><code>plotGroves</code></strong>: scatterplot of groups of trees, and <strong><code>plotGrovesD3</code></strong> which enables interactive plotting based on d3.js * <strong><code>medTree</code></strong>: find geometric median tree(s) to summarise a group of trees</p>
<p>Other functions are central to the computations of distances between trees: * <strong><code>treeVec</code></strong>: characterise a tree by a vector * <strong><code>treeDist</code></strong>: find the distance between two tree vectors * <strong><code>multiDist</code></strong>: find the pairwise distances of a list of trees * <strong><code>refTreeDist</code></strong>: find the distances of a list of trees from a reference tree * <strong><code>tipDiff</code></strong>: for a pair of trees, list the tips with differing ancestry * <strong><code>plotTreeDiff</code></strong>: plot a pair of trees, highlighting the tips with differing ancestry</p>
<p>Distributed datasets include: * <strong><code>woodmiceTrees</code></strong>: illustrative set of 201 trees built using the neighbour-joining and bootstrapping example from the <em>woodmice</em> dataset in the <em>ape</em> documentation. * <strong><code>DengueTrees</code></strong>: 500 trees sampled from a BEAST posterior set of trees from (Drummond and Rambaut, 2007) * <strong><code>DengueSeqs</code></strong>: 17 dengue virus serotype 4 sequences from (Lanciotti <em>et al.</em>, 1997), from which the <code>DengueTrees</code> were inferred. * <strong><code>DengueBEASTMCC</code></strong>: the maximum clade credibility (MCC) tree from the <code>DengueTrees</code>.</p>
</div>
<div id="exploring-trees-with-treespace" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-trees-with-treespace" class="anchor"> </a>Exploring trees with <em>treespace</em>
</h2>
<p>We first load <em>treespace</em>, and the packages required for graphics:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"treespace"</span>)
<span class="kw">library</span>(<span class="st">"adegenet"</span>)
<span class="kw">library</span>(<span class="st">"adegraphics"</span>)
<span class="kw">library</span>(<span class="st">"ggplot2"</span>)</code></pre></div>
<p>The function <code>treespace</code> defines typologies of phylogenetic trees using a two-step approach:</p>
<ol style="list-style-type: decimal">
<li><p>perform pairwise comparisons of trees using various (Euclidean) metrics; by default, the comparison uses the Kendall and Colijn metric (Kendall and Colijn, 2016) which is described in more detail below; other metrics rely on tip distances implemented in <em>adephylo</em> (Jombart <em>et al.</em>, 2010) and <em>phangorn</em> (Schliep 2011).</p></li>
<li><p>use Metric Multidimensional Scaling (MDS, aka Principal Coordinates Analysis, PCoA) to summarise pairwise distances between the trees as well as possible into a few dimensions; the output of the MDS is typically visualised using scatterplots of the first few Principal Components (PCs); this step relies on the PCoA implemented in <em>ade4</em> (Dray and Dufour, 2007).</p></li>
</ol>
<p>The function <code>treespace</code> performs both tasks, returning both the matrix of pairwise tree comparisons (<code>$D</code>), and the PCoA (<code>$pco</code>). This can be illustrated using randomly generated trees:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate list of trees</span>
<span class="kw">set.seed</span>(<span class="dv">1</span>)
x &lt;-<span class="st"> </span><span class="kw">rmtree</span>(<span class="dv">10</span>, <span class="dv">20</span>)
<span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">"tree"</span>, <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">""</span>)

<span class="co"># use treespace</span>
res &lt;-<span class="st"> </span><span class="kw"><a href="reference/treespace.html">treespace</a></span>(x, <span class="dt">nf=</span><span class="dv">3</span>)
<span class="kw">names</span>(res)</code></pre></div>
<pre><code>## [1] "D"   "pco"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res</code></pre></div>
<pre><code>## $D
##        tree1 tree2 tree3 tree4 tree5 tree6 tree7 tree8 tree9
## tree2  26.00                                                
## tree3  31.06 26.74                                          
## tree4  42.85 42.12 44.44                                    
## tree5  30.66 27.71 27.37 44.79                              
## tree6  36.50 31.18 30.18 41.81 31.59                        
## tree7  34.64 28.71 29.48 40.35 31.11 32.37                  
## tree8  28.97 26.29 24.45 43.74 23.47 30.41 29.00            
## tree9  29.63 27.42 27.48 45.61 26.31 30.89 29.77 24.60      
## tree10 34.87 30.00 29.44 44.97 34.06 31.05 34.41 31.54 32.59
## 
## $pco
## Duality diagramm
## class: pco dudi
## $call: dudi.pco(d = D, scannf = is.null(nf), nf = nf)
## 
## $nf: 3 axis-components saved
## $rank: 9
## eigen values: 142.1 76.52 62.69 49.88 41.07 ...
##   vector length mode    content       
## 1 $cw    9      numeric column weights
## 2 $lw    10     numeric row weights   
## 3 $eig   9      numeric eigen values  
## 
##   data.frame nrow ncol content             
## 1 $tab       10   9    modified array      
## 2 $li        10   3    row coordinates     
## 3 $l1        10   3    row normed scores   
## 4 $co        9    3    column coordinates  
## 5 $c1        9    3    column normed scores
## other elements: NULL</code></pre>
<p>Pairwise tree distances can be visualised using <em>adegraphics</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># table.image</span>
<span class="kw">table.image</span>(res$D, <span class="dt">nclass=</span><span class="dv">30</span>)</code></pre></div>
<p><img src="vignettes/figs/distances_readme-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># table.value with some customization</span>
<span class="kw">table.value</span>(res$D, <span class="dt">nclass=</span><span class="dv">5</span>, <span class="dt">method=</span><span class="st">"color"</span>, 
            <span class="dt">symbol=</span><span class="st">"circle"</span>, <span class="dt">col=</span><span class="kw">redpal</span>(<span class="dv">5</span>))</code></pre></div>
<p><img src="vignettes/figs/distances_readme-2.png" width="672"></p>
<p>The best representation of these distances in a 2-dimensional space is given by the first 2 PCs of the MDS. These can be visualised using any scatter plotting tool; here we use the <em>treespace</em> function <code>plotGroves</code>, based on the <em>adegraphics</em> function <code>scatter</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/plotGroves.html">plotGroves</a></span>(res$pco, <span class="dt">lab.show=</span><span class="ot">TRUE</span>, <span class="dt">lab.cex=</span><span class="fl">1.5</span>)</code></pre></div>
<p><img src="vignettes/figs/plotgroves_readme-1.png" width="672"></p>
<p>The functionality of <code>treespace</code> can be further illustrated using <em>ape</em>’s dataset <em>woodmouse</em>, from which we built the 201 trees supplied in <code>woodmiceTrees</code> using the neighbour-joining and bootstrapping example from the <em>ape</em> documentation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(woodmiceTrees)
wm.res &lt;-<span class="st"> </span><span class="kw"><a href="reference/treespace.html">treespace</a></span>(woodmiceTrees,<span class="dt">nf=</span><span class="dv">3</span>)

<span class="co"># PCs are stored in:</span>
<span class="kw">head</span>(wm.res$pco$li)</code></pre></div>
<pre><code>##         A1     A2      A3
## 1  -0.9949 -1.363 -0.7918
## 2  -0.6137 -1.014 -0.6798
## 3   2.6667  4.219 -2.9293
## 4 -13.6081  1.854  1.0947
## 5   2.1980  4.176 -3.1960
## 6   3.6013  4.865  2.9853</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot results</span>
<span class="kw"><a href="reference/plotGroves.html">plotGroves</a></span>(wm.res$pco)</code></pre></div>
<p><img src="vignettes/figs/woodmicePlots_readme-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># visualising density of points</span>
<span class="kw">s.kde2d</span>(wm.res$pco$li)</code></pre></div>
<p><img src="vignettes/figs/woodmicePlots_readme-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># alternative using ggplot2</span>
woodmiceplot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(wm.res$pco$li, <span class="kw">aes</span>(<span class="dt">x=</span>A1, <span class="dt">y=</span>A2)) <span class="co"># create plot</span>
woodmiceplot +<span class="st"> </span><span class="kw">geom_density2d</span>(<span class="dt">colour=</span><span class="st">"gray80"</span>) +<span class="st"> </span><span class="co"># contour lines</span>
<span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">6</span>, <span class="dt">shape=</span><span class="dv">1</span>, <span class="dt">colour=</span><span class="st">"gray50"</span>) +<span class="st"> </span><span class="co"># grey edges</span>
<span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">6</span>, <span class="dt">alpha=</span><span class="fl">0.2</span>, <span class="dt">colour=</span><span class="st">"navy"</span>) +<span class="st"> </span><span class="co"># transparent blue points</span>
<span class="kw">xlab</span>(<span class="st">""</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">""</span>) +<span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_family=</span><span class="st">""</span>) <span class="co"># remove axis labels and grey background</span></code></pre></div>
<p><img src="vignettes/figs/woodmicePlots_readme-3.png" width="672"></p>
<p>Interactive plots are also available using <code>plotGrovesD3</code> and <em>rgl</em>’s <code>plot3d</code>.</p>
<p>Note that alternatively, the function <code>multiDist</code> simply performs the pairwise comparison of trees and outputs a distance matrix. This function may be preferable for large datasets, and when principal co-ordinate analysis is not required. It includes an option to save memory at the expense of computation time.</p>
</div>
<div id="identifying-clusters-of-trees" class="section level2">
<h2 class="hasAnchor">
<a href="#identifying-clusters-of-trees" class="anchor"> </a>Identifying clusters of trees</h2>
<p>Once a typology of trees has been derived using the approach described above, one may want to formally identify clusters of similar trees. One simple approach is:</p>
<ol style="list-style-type: decimal">
<li><p>select a few first PCs of the MDS (retaining signal but getting rid of random noise)</p></li>
<li><p>derive pairwise Euclidean distances between trees based on these PCs</p></li>
<li><p>use hierarchical clustering to obtain a dendrogram of these trees</p></li>
<li><p>cut the dendrogram to obtain clusters</p></li>
</ol>
<p>In <em>treespace</em>, the function <code>findGroves</code> implements this approach, offering various clustering options (see <code><a href="reference/findGroves.html">?findGroves</a></code>). Here we supply the function with our <code>treespace</code> output <code>wm.res</code> since we have already calculated it, but it is also possible to skip the steps above and directly supply <code>findGroves</code> with a multiPhylo list of trees.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wm.groves &lt;-<span class="st"> </span><span class="kw"><a href="reference/findGroves.html">findGroves</a></span>(wm.res, <span class="dt">nclust=</span><span class="dv">6</span>)
<span class="kw">names</span>(wm.groves)</code></pre></div>
<pre><code>## [1] "groups"    "treespace"</code></pre>
<p>Note that when the number of clusters (<code>nclust</code>) is not provided, the function will display a dendrogram and ask for a cut-off height.</p>
<p>The results can be plotted directly using <code>plotGroves</code> (see <code><a href="reference/plotGroves.html">?plotGroves</a></code> for options):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># basic plot</span>
<span class="kw"><a href="reference/plotGroves.html">plotGroves</a></span>(wm.groves)</code></pre></div>
<p><img src="vignettes/figs/plotgroves2_readme-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># alternative with inertia ellipses</span>
<span class="kw"><a href="reference/plotGroves.html">plotGroves</a></span>(wm.groves, <span class="dt">type=</span><span class="st">"ellipse"</span>)</code></pre></div>
<p><img src="vignettes/figs/plotgroves2_readme-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot axes 2 and 3. This helps to show why, for example, clusters 2 and 4 have been identified as separate, despite them appearing to overlap when viewing axes 1 and 2.</span>
<span class="kw"><a href="reference/plotGroves.html">plotGroves</a></span>(wm.groves, <span class="dt">xax=</span><span class="dv">2</span>, <span class="dt">yax=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="vignettes/figs/plotgroves2_readme-3.png" width="672"></p>
</div>
<div id="treespaceserver-a-web-application-for-treespace" class="section level2">
<h2 class="hasAnchor">
<a href="#treespaceserver-a-web-application-for-treespace" class="anchor"> </a>
<code>treespaceServer</code>: a web application for <em>treespace</em>
</h2>
<p>The functionalities of <code>treespace</code> are also available via a user-friendly web interface, running locally on the default web browser. It can be started by simply typing <code><a href="reference/treespaceServer.html">treespaceServer()</a></code>. The interface allows you to import trees and run <code>treespace</code> to view and explore the tree space in 2 or 3 dimensions. It is then straightforward to analyse the tree space by varying lambda, looking for clusters using <code>findGroves</code> and saving results in various formats. Individual trees can be easily viewed including median trees per cluster, and collections of trees can be seen together using <code>densiTree</code> from the package <code>phangorn</code>. <strong>It is fully documented in the <em>help</em> tab.</strong></p>
<p><img src="vignettes/figs/treespace3d.png" style="width:650px"></p>
<p><img src="vignettes/figs/treespaceTree.png" style="width:650px"></p>
<p><img src="vignettes/figs/treespaceDensiTree.png" style="width:650px"></p>
</div>
<div id="finding-median-trees" class="section level2">
<h2 class="hasAnchor">
<a href="#finding-median-trees" class="anchor"> </a>Finding median trees</h2>
<p>When a set of trees have very similar structures, it makes sense to summarize them into a single ‘consensus’ tree. In <code>treespace</code>, this is achieved by finding the <em>median tree</em> for a set of trees according to the Kendall and Colijn metric. That is, we find the tree which is closest to the centre of the set of trees in the tree landscape defined in <code>treespace</code>. This procedure is implemented by the function <code>medTree</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get first median tree</span>
tre &lt;-<span class="st"> </span><span class="kw"><a href="reference/medTree.html">medTree</a></span>(woodmiceTrees)$trees[[<span class="dv">1</span>]]

<span class="co"># plot tree</span>
<span class="kw">plot</span>(tre,<span class="dt">type=</span><span class="st">"cladogram"</span>,<span class="dt">edge.width=</span><span class="dv">3</span>, <span class="dt">cex=</span><span class="fl">0.8</span>)</code></pre></div>
<p><img src="vignettes/figs/woodmiceMedian_readme-1.png" width="672"></p>
<p>However, a more complete and accurate summary of the data can be given by finding a summary tree from each cluster. This is achieved using the <code>groups</code> argument of <code>medTree</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># find median trees for the 6 clusters identified earlier:</span>
res &lt;-<span class="st"> </span><span class="kw"><a href="reference/medTree.html">medTree</a></span>(woodmiceTrees, wm.groves$groups)

<span class="co"># there is one output per cluster</span>
<span class="kw">names</span>(res)</code></pre></div>
<pre><code>## [1] "1" "2" "3" "4" "5" "6"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get the first median of each</span>
med.trees &lt;-<span class="st"> </span><span class="kw">lapply</span>(res, function(e) <span class="kw">ladderize</span>(e$trees[[<span class="dv">1</span>]]))

<span class="co"># plot trees</span>
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))
for(i in <span class="dv">1</span>:<span class="kw">length</span>(med.trees)) <span class="kw">plot</span>(med.trees[[i]], <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">"cluster"</span>,i),<span class="dt">cex=</span><span class="fl">1.5</span>)</code></pre></div>
<p><img src="vignettes/figs/woodmiceCluster1_readme-1.png" width="600px"></p>
<p>These trees exhibit a number of topological differences, e.g. in the placement of the <strong>(1007S,1208S,0909S)</strong> clade. To examine the differences between the trees in a pairwise manner, we can use the function <code>plotTreeDiff</code>, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Compare median trees from clusters 1 and 2:</span>
<span class="kw"><a href="reference/plotTreeDiff.html">plotTreeDiff</a></span>(med.trees[[<span class="dv">1</span>]],med.trees[[<span class="dv">2</span>]], <span class="dt">use.edge.length=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="vignettes/figs/woodmice_plotTreeDiff_readme-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Compare median trees from clusters 1 and 4, and change aesthetics:</span>
<span class="kw"><a href="reference/plotTreeDiff.html">plotTreeDiff</a></span>(med.trees[[<span class="dv">1</span>]],med.trees[[<span class="dv">4</span>]], <span class="dt">type=</span><span class="st">"cladogram"</span>, <span class="dt">use.edge.length=</span><span class="ot">FALSE</span>, <span class="dt">edge.width=</span><span class="dv">2</span>, <span class="dt">colourMethod=</span><span class="st">"palette"</span>,<span class="dt">palette=</span>spectral)</code></pre></div>
<p><img src="vignettes/figs/woodmice_plotTreeDiff_readme-2.png" width="672"></p>
<p>Performing this analysis enables the detection of distinct representative trees supported by data.</p>
<p>Note that in this example we supplied the function <code>medTree</code> with the multiPhylo list of trees. A more computationally efficient process (at the expense of using more memory) is to use the option <code>return.tree.vectors</code> in the initial <code>treespace</code> call, and then supply these vectors directly to <code>medTree</code>. In this case, the tree indices are returned by <code>medTree</code> but the trees are not (since they were not supplied).</p>
</div>
<div id="emphasising-the-placement-of-certain-tips-or-clades" class="section level2">
<h2 class="hasAnchor">
<a href="#emphasising-the-placement-of-certain-tips-or-clades" class="anchor"> </a>Emphasising the placement of certain tips or clades</h2>
<p>In some analyses it may be informative to emphasise the placement of particular tips or clades within a set of trees. This can be particularly useful in large trees where the study is focused on a smaller clade. Priority can be given to a list of tips using the argument <code>emphasise.tips</code>, whose corresponding values in the vector comparison will be given a weight of <code>emphasise.weight</code> times the others (the default is 2, i.e. twice the weight).</p>
<p>For example, if we wanted to emphasise where the woodmice trees agree and disagree on the placement of the <strong>(1007S,1208S,0909S)</strong> clade, we can simply emphasise that clade as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wm3.res &lt;-<span class="st"> </span><span class="kw"><a href="reference/treespace.html">treespace</a></span>(woodmiceTrees,<span class="dt">nf=</span><span class="dv">2</span>,<span class="dt">emphasise.tips=</span><span class="kw">c</span>(<span class="st">"No1007S"</span>,<span class="st">"No1208S"</span>,<span class="st">"No0909S"</span>),<span class="dt">emphasise.weight=</span><span class="dv">3</span>)

<span class="co"># plot results</span>
<span class="kw"><a href="reference/plotGroves.html">plotGroves</a></span>(wm3.res$pco)</code></pre></div>
<p><img src="vignettes/figs/woodmice-tip-emphasis_readme-1.png" width="672"></p>
<p>It can be seen from the scale of the plot and the density of clustering that the trees are now separated into more distinct clusters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wm3.groves &lt;-<span class="st"> </span><span class="kw"><a href="reference/findGroves.html">findGroves</a></span>(woodmiceTrees,<span class="dt">nf=</span><span class="dv">3</span>,<span class="dt">nclust=</span><span class="dv">6</span>,<span class="dt">emphasise.tips=</span><span class="kw">c</span>(<span class="st">"No1007S"</span>,<span class="st">"No1208S"</span>,<span class="st">"No0909S"</span>),<span class="dt">emphasise.weight=</span><span class="dv">3</span>)
<span class="kw"><a href="reference/plotGroves.html">plotGroves</a></span>(wm3.groves, <span class="dt">type=</span><span class="st">"ellipse"</span>)</code></pre></div>
<p><img src="vignettes/figs/findgroves-with-emphasis_readme-1.png" width="672"></p>
<p>Conversely, where the structure of a particular clade is not of interest (for example, lineages within an outgroup which was only included for rooting purposes), those tips can be given a weight less than 1 so as to give them less emphasis in the comparison. We note that although it is possible to give tips a weighting of 0, we advise caution with this as the underlying function will no longer be guaranteed to be a metric. That is, a distance of 0 between two trees will no longer necessarily imply that the trees are identical. In most cases it would be wiser to assign a very small weighting to tips which are not of interest.</p>
</div>
<div id="method-characterising-a-tree-by-a-vector" class="section level2">
<h2 class="hasAnchor">
<a href="#method-characterising-a-tree-by-a-vector" class="anchor"> </a>Method: characterising a tree by a vector</h2>
<p>Kendall and Colijn proposed a <a href="http://dx.doi.org/10.1093/molbev/msw124">metric</a> for comparing rooted phylogenetic trees (Kendall and COlijn, 2016). Each tree is characterised by a vector which notes the placement of the most recent common ancestor (MRCA) of each pair of tips, as demonstrated in this example:</p>
<p><img src="vignettes/figs/construction.png" style="width:650px"></p>
<p>Specifically, it records the distance between the MRCA of a pair of tips <em>(i,j)</em> and the root in two ways: the number of edges <em>m(i,j)</em>, and the path length <em>M(i,j)</em>. It also records the length <em>p(i)</em> of each ‘pendant’ edge between a tip <em>i</em> and its immediate ancestor. This procedure results in two vectors for a tree <em>T</em>:</p>
<p><em>m(T) = (m(1,2), m(1,3),…,m(k-1,k),1,…,1)</em></p>
<p>and</p>
<p><em>M(T) = (M(1,2), M(1,3),…,M(k-1,k),p(1),…,p(k)).</em></p>
<p>In <em>m(T)</em> we record the pendant lengths as 1, as each tip is 1 step from its immediate ancestor. We combine <em>m</em> and <em>M</em> with a parameter lambda between zero and one to weight the contribution of branch lengths, characterising each tree with a vector</p>
<p><em>v{lambda}(T) = (1-lambda)m(T) + lambda M(T)</em>.</p>
<p>This is implemented as the function <strong><code>treeVec</code></strong>. For example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate a random tree:</span>
tree &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">6</span>)
<span class="co"># topological vector of mrca distances from root:</span>
<span class="kw"><a href="reference/treeVec.html">treeVec</a></span>(tree)</code></pre></div>
<pre><code>##  [1] 1 1 0 2 0 2 0 1 0 0 1 0 0 1 0 1 1 1 1 1 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># vector of mrca distances from root when lambda=0.5:</span>
<span class="kw"><a href="reference/treeVec.html">treeVec</a></span>(tree,<span class="fl">0.5</span>)</code></pre></div>
<pre><code>##  [1] 0.6775 0.6775 0.0000 1.3465 0.0000 1.3670 0.0000 0.6775 0.0000 0.0000
## [11] 0.6775 0.0000 0.0000 0.9442 0.0000 0.6646 0.8074 0.7531 0.5180 0.7866
## [21] 0.5690</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># vector of mrca distances as a function of lambda:</span>
vecAsFunction &lt;-<span class="st"> </span><span class="kw"><a href="reference/treeVec.html">treeVec</a></span>(tree,<span class="dt">return.lambda.function=</span><span class="ot">TRUE</span>)
<span class="co"># evaluate the vector at lambda=0.5:</span>
<span class="kw">vecAsFunction</span>(<span class="fl">0.5</span>)</code></pre></div>
<pre><code>##  [1] 0.6775 0.6775 0.0000 1.3465 0.0000 1.3670 0.0000 0.6775 0.0000 0.0000
## [11] 0.6775 0.0000 0.0000 0.9442 0.0000 0.6646 0.8074 0.7531 0.5180 0.7866
## [21] 0.5690</code></pre>
<p>The metric – the distance between two trees – is the Euclidean distance between these vectors:</p>
<p><em>d{lambda}(Ta, Tb) = || v{lambda}(Ta) - v{lambda}(Tb) ||.</em></p>
<p>This can be found using <strong><code>treeDist</code></strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate random trees</span>
tree_a &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">6</span>)
tree_b &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">6</span>)

<span class="co"># topological (lambda=0) distance:</span>
<span class="kw"><a href="reference/treeDist.html">treeDist</a></span>(tree_a,tree_b) </code></pre></div>
<pre><code>## [1] 5.477</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># branch-length focused (lambda=1) distance:</span>
<span class="kw"><a href="reference/treeDist.html">treeDist</a></span>(tree_a,tree_b,<span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 3.149</code></pre>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"> </a>References</h2>
<ul>
<li><p>Dray, S. and Dufour, A. B. (2007) The ade4 package: implementing the duality diagram for ecologists. Journal of Statistical Software 22(4): 1-20.</p></li>
<li><p>Drummond, A. J. and Rambaut, A. (2007) BEAST: Bayesian evolutionary analysis by sampling trees. BMC Evolutionary Biology, 7(1), 214.</p></li>
<li><p>Jombart, T., Balloux, F. and Dray, S. (2010) adephylo: new tools for investigating the phylogenetic signal in biological traits. Bioinformatics 26: 1907-1909. DOI: 10.1093/bioinformatics/btq292</p></li>
<li><p>Kendall, M. and Colijn, C. (2016) Mapping phylogenetic trees to reveal distinct patterns of evolution. Molecular Biology and Evolution, first published online: June 24, 2016. DOI: 10.1093/molbev/msw124</p></li>
<li><p>Lanciotti, R. S., Gubler, D. J. and Trent, D. W. (1997) Molecular evolution and phylogeny of dengue-4 viruses. Journal of General Virology, 78(9), 2279-2286.</p></li>
<li><p>Schliep, K. P. (2011) phangorn: phylogenetic analysis in R. Bioinformatics 27(4): 592-593.</p></li>
</ul>
</div>
<div id="authors-contributors" class="section level2">
<h2 class="hasAnchor">
<a href="#authors-contributors" class="anchor"> </a>Authors / Contributors</h2>
<p>Authors: * <a href="https://sites.google.com/site/thibautjombart/">Thibaut Jombart</a> * <a href="http://www.imperial.ac.uk/people/m.kendall">Michelle Kendall</a></p>
<p>Contributors: * <a href="http://www.well.ox.ac.uk/jacob-almagro-garcia">Jacob Almagro-Garcia</a> * <a href="http://www.imperial.ac.uk/people/c.colijn">Caroline Colijn</a></p>
<p>Maintainer of the CRAN version: * <a href="http://www.imperial.ac.uk/people/m.kendall">Michelle Kendall</a></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>License</h2>
<p>GPL (&gt;=2)</p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Thibaut Jombart <br><small class="roles"> Author </small> </li>
<li>Michelle Kendall <br><small class="roles"> Author, maintainer </small> </li>
<li>Jacob Almagro-Garcia <br><small class="roles"> Author </small> </li>
<li>Caroline Colijn <br><small class="roles"> Author </small> </li>
</ul>
<html><body>
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/thibautjombart/treespace"><img src="https://travis-ci.org/thibautjombart/treespace.png?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/thibautjombart/treespace/branch/master"><img src="https://ci.appveyor.com/api/projects/status/klr8khh1ieb26rh4/branch/master?svg=true" alt="Build status"></a></li>
<li><a href="https://cran.r-project.org/package=treespace"><img src="http://www.r-pkg.org/badges/version/treespace" alt="CRAN Status Badge"></a></li>
<li><a href="https://cran.r-project.org/package=treespace"><img src="https://cranlogs.r-pkg.org/badges/treespace" alt="CRAN Downloads"></a></li>
</ul>
</body></html>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thibaut Jombart, Michelle Kendall, Jacob Almagro-Garcia, Caroline Colijn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
